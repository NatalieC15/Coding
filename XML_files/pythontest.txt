#Choosing the LRG file to obtain the chromosome number of the gene and the exon start and stop coordinates after downloading the file of interest from the LRG website
#Below is a test for entering the correct file name as a number
#The test works for when you have a downloaded file with the correct file name
#There is currently a traceback error when a non-numerical value is entered saying the LRG_file_name is not defined need to break the code so it loops back to the input question
#Need to add an error message to check that the user has downloaded the correct file from the LRG website
LRG_file_number = input('Enter LRG file number of interest: ')
try:
	LRG_file_number = int(LRG_file_number)

	LRG_file_number = str(LRG_file_number)
	LRG_file_name = 'LRG_' + LRG_file_number + '.xml'


#Below is a test to check the the LRG_file_name was written correctly
	print(LRG_file_name)

except:
	print('Error, please enter numeric input')


#importing ElementTree and parsing the XML file
import xml.etree.ElementTree as ET
tree = ET.parse(LRG_file_name)
root = tree.getroot()

root.attrib
#{'schema_version': '1.9'} - this was the result of looking at the root attribute

for child in root:
     print(child.tag, child.attrib)
#fixed_annotation {}
#updatable_annotation {} - these were both results from looking at the root child relationship

print(ET.tostring(root, encoding='utf8').decode('utf8'))
#output is the tree structure to base further work on

#This is code to find the exon start and end coordinates (after much error, all it takes is an extra /)
#".// - must have 2 /'s to get label information.
start =[]
end = []
label = []
#creation of lists
for exon in root.findall(".//fixed_annotation/transcript/exon"):
	label.append(exon.get('label'))
	coordinates = exon.find('coordinates')
	start.append(coordinates.get('start'))
	end.append(coordinates.get('end'))

##Use the print function to test the list creation for label, start and end
#print (label, start, end)

#Finding the chromosome number, start and end coordinates within the XML file, this finds the build number GRCh37.p13. May not converse for every file.
#May need to find a way to pull only the GRCh37 build in the future. 
for annotation_set in root.findall(".//updatable_annotation/annotation_set[@type='lrg']"):
	mapping = annotation_set.find('mapping')
	chrom = mapping.get('other_name')
	chromstart = mapping.get('other_start')
	chromend = mapping.get('other_end')

##Use the print function to test the at the correct values for chromosome number, genomic start and end coordinates.
#print(chrom, chromstart, chromend)

#Code to extract the gene name
for annotation_set in root.findall(".//updatable_annotation/annotation_set[@type='lrg']"):
     lrg_locus = annotation_set.find('lrg_locus')
     print(lrg_locus.text)

#Creation of the .bed file
f = open("lrg.bed", "w")
f.write("Chrom" + "\t" + "Start" + "\t" + "End" + "\n")
for i in range(len(start)):
	f.write(str(chrom) + "\t" + str(start[i]) + "\t" + str(end[i]) + "\n")

f.close()